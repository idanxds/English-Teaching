<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אתר למידה באנגלית</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Global Styles --- */
        :root {
            --primary-color: #3498db;
            --primary-hover: #2980b9;
            --secondary-color: #2c3e50;
            --light-color: #ffffff;
            --gray-color: #ecf0f1;
            --dark-gray-color: #bdc3c7;
            --text-color: #34495e;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --font-family: 'Assistant', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--gray-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-top: 60px; /* Space for fixed nav */
        }

        h1, h2, h3 {
            margin-bottom: 15px;
            font-weight: 700;
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.5rem; color: var(--primary-color); }

        p {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* --- Utilities --- */
        .hidden {
            display: none !important;
        }

        .ltr {
            direction: ltr;
            text-align: left;
        }

        .page {
            width: 100%;
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background-color: var(--light-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease-in-out;
            position: relative; /* For back button positioning */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Buttons --- */
        .action-button, .nav-button, .back-button, .assignment-box, .quiz-option-btn, .admin-user-btn {
            font-family: var(--font-family);
            font-size: 1.1rem;
            font-weight: 600;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: var(--primary-color);
            color: var(--light-color);
            text-decoration: none;
            display: inline-block;
        }

        .action-button:hover, .nav-button:hover, .back-button:hover, .assignment-box:hover, .quiz-option-btn:hover, .admin-user-btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .action-button.large {
            font-size: 1.5rem;
            padding: 15px 30px;
        }
        
        .action-button.small {
            font-size: 1rem;
            padding: 8px 12px;
        }

        .action-button.secondary {
            background-color: var(--secondary-color);
        }
        .action-button.secondary:hover {
            background-color: #1a252f;
        }


        .back-button {
            background-color: var(--secondary-color);
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 10;
        }
        .back-button:hover { background-color: #34495e; }

        /* --- Main Navigation --- */
        .main-nav {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: var(--secondary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px; /* Adjusted for full width */
            z-index: 1000;
        }

        .main-nav .nav-button {
            background: none;
            margin-left: 10px;
        }
        .main-nav .nav-button:hover {
            background: none;
            color: var(--primary-color);
            transform: none;
            box-shadow: none;
        }
        .main-nav .nav-brand .nav-button {
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        /* --- Home Page --- */
        .home-container {
            text-align: center;
            padding: 50px 0;
        }

        /* --- Assignment Hub --- */
        .assignments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .assignment-box {
            text-align: right;
            padding: 20px;
            border: 1px solid var(--primary-color);
            background-color: var(--light-color);
            color: var(--primary-color);
        }
        .assignment-box:hover {
            background-color: var(--primary-color);
            color: var(--light-color);
        }
        .assignment-box:hover h3, .assignment-box:hover p {
            color: var(--light-color);
        }
        .assignment-box h3 {
            margin-bottom: 10px;
        }
        .assignment-box p {
            font-size: 1rem;
            color: var(--text-color);
            margin: 0;
        }
        .assignment-box.completed {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: var(--light-color);
            opacity: 0.7;
        }
        .assignment-box.completed:hover {
            background-color: #27ae60;
        }
        .assignment-box.completed p, .assignment-box.completed h3 {
            color: var(--light-color);
        }

        /* --- Podcast Page --- */
        .podcast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .podcast-player {
            background-color: var(--gray-color);
            padding: 15px;
            border-radius: 8px;
        }
        .podcast-player h3 {
            margin-bottom: 10px;
        }
        .podcast-player audio {
            width: 100%;
        }

        /* --- YouTube Page --- */
        .youtube-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        .youtube-grid .action-button {
            width: 100%;
            padding: 20px 10px;
            font-size: 1rem;
            text-align: center;
        }

        /* --- Video Player Page --- */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: 8px;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* --- Task Page --- */
        #task-content {
            background-color: var(--gray-color);
            padding: 30px;
            border-radius: 8px;
        }
        #task-content h2 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        #task-content ul {
            margin-right: 20px;
            margin-bottom: 15px;
        }
        #task-content .text-passage {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid var(--dark-gray-color);
        }
        #task-content .text-passage p {
            margin-bottom: 5px;
        }
        #task-content .action-button {
            margin-right: 10px;
            margin-top: 10px;
        }

        /* --- Quiz Page --- */
        #quiz-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #quiz-progress {
            font-size: 1rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        #quiz-question {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 30px;
            direction: ltr;
            text-align: left;
        }
        #quiz-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        .quiz-option-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            background-color: var(--light-color);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            text-align: left;
            direction: ltr;
        }
        .quiz-option-btn:hover {
            background-color: var(--primary-color);
            color: var(--light-color);
        }
        .quiz-option-btn.selected {
            background-color: var(--primary-color);
            color: var(--light-color);
        }
        .quiz-option-btn.correct {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: var(--light-color);
        }
        .quiz-option-btn.incorrect {
            background-color: var(--error-color);
            border-color: var(--error-color);
            color: var(--light-color);
            animation: shake 0.3s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        #quiz-feedback {
            margin-top: 20px;
            font-size: 1.3rem;
            font-weight: 700;
        }
        #quiz-feedback.correct {
            color: var(--success-color);
        }
        #quiz-feedback.incorrect {
            color: var(--error-color);
        }

        #quiz-next-btn {
            display: block;
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            font-size: 1.2rem;
        }
        
        /* --- ABC Audio Page --- */
        .audio-players-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        .audio-player {
            text-align: center;
        }
        .audio-player audio {
            margin-top: 5px;
        }
        
        /* --- Sentence Builder Page --- */
        #built-sentence-container {
            min-height: 50px;
            border-bottom: 2px solid #ccc;
            margin-bottom: 20px;
            font-size: 1.5em;
            direction: ltr;
            text-align: left;
            padding: 10px;
            background: #fff;
            border-radius: 8px;
        }
        
    </style>
</head>
<body>
    
    <nav class="main-nav">
        <div class="nav-links">
            <button class="nav-button" data-target="youtube-page">סרטוני YouTube</button>
            <button class="nav-button" data-target="podcast-page">פודקאסט</button>
        </div>
        <div class="nav-brand">
            <button class="nav-button" data-target="home-page">עמוד הבית</button>
        </div>
    </nav>

    <div id="app">
        <section id="home-page" class="page">
            <div class="home-container">
                <h1>ברוכים הבאים לאתר הלמידה</h1>
                <p>מוכנים להתחיל ללמוד אנגלית?</p>
                <button id="login-button" class="action-button large">כניסה</button>
            </div>
        </section>

        <section id="assignment-hub-page" class="page hidden">
            <button class="back-button" data-target="home-page">חזרה</button>
            <h1>משימות למידה</h1>
            <div class="assignments-grid">
                <button class="assignment-box" data-assignment="abc">
                    <h3>ה-ABC האנגלי</h3>
                    <p>לימוד אותיות, שמע ומקרים מיוחדים.</p>
                </button>
                <button class="assignment-box" data-assignment="verbs">
                    <h3>פעלים (Verbs)</h3>
                    <p>לימוד פעלים, תרגול ובניית משפטים.</p>
                </button>
                <button class="assignment-box" data-assignment="future-simple">
                    <h3>עתיד פשוט (Future Simple)</h3>
                    <p>לימוד ותרגול שימוש ב-will ו-would.</p>
                </button>
                <button class="assignment-box" data-assignment="simple-past">
                    <h3>עבר פשוט (Simple Past)</h3>
                    <p>לימוד חוקים, פעלים רגילים ויוצאי דופן.</p>
                </button>
                
                <button class="assignment-box" data-assignment="reading">
                    <h3>קריאה (Reading)</h3>
                    <p>תרגול קטעי קריאה ברמות שונות.</p>
                </button>
                <button class="assignment-box" data-assignment="grammar">
                    <h3>דקדוק (Grammar)</h3>
                    <p>לימוד ותרגול WH, Present Simple ועוד.</p>
                </button>
                <button class="assignment-box" data-assignment="writing">
                    <h3>כתיבה (Writing)</h3>
                    <p>למדו לתאר, להשוות ולכתוב פסקאות.</p>
                </button>
                <button class="assignment-box" data-assignment="speaking">
                    <h3>דיבור (Speaking)</h3>
                    <p>תרגול זיהוי שגיאות וקריאה נכונה.</p>
                </button>
                <button class="assignment-box" data-assignment="adjectives">
                    <h3>שמות תואר (Adjectives)</h3>
                    <p>תרגול שמות תואר ותואר הפועל.</p>
                </button>
            </div>
        </section>

        <section id="podcast-page" class="page hidden">
            <button class="back-button" data-target="home-page">חזרה</button>
            <h1>פודקאסטים</h1>
            <div class="podcast-grid">
                <div class="podcast-player">
                    <h3>פודקאסט 1</h3>
                    <audio controls src="https://archive.org/download/full-podcast_202511/Full%20Podcast.mp3">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 2</h3>
                    <audio controls src="audio1.opus">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 3</h3>
                    <audio controls src="audio2.opus">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 4</h3>
                    <audio controls src="audio3.opus">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 5</h3>
                    <audio controls src="audio4.mp3">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 6</h3>
                    <audio controls src="vid3.mp4">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 7</h3>
                    <audio controls src="YOUR_AUDIO_FILE_7.mp3">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 8</h3>
                    <audio controls src="YOUR_AUDIO_FILE_8.mp3">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 9</h3>
                    <audio controls src="YOUR_AUDIO_FILE_9.mp3">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 10</h3>
                    <audio controls src="YOUR_AUDIO_FILE_10.mp3">דפדפן זה אינו תומך באודיו.</audio>
                </div>
                <div class="podcast-player">
                    <h3>פודקאסט 11</h3>
                    <audio controls src="YOUR_AUDIO_FILE_11.mp3">דפדפן זה אינו תומך באודיו.</audio>
                </div>
            </div>
        </section>

        <section id="youtube-page" class="page hidden">
            <button class="back-button" data-target="home-page">חזרה</button>
            <h1>סרטוני YouTube</h1>
            <div class="youtube-grid">
                </div>
        </section>

        <section id="video-player-page" class="page hidden">
            <button class="back-button" data-target="youtube-page">חזרה לסרטונים</button>
            <h1 id="video-player-title"></h1>
            <div class="video-container">
                <iframe id="youtube-iframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </section>

        <section id="task-page" class="page hidden">
            <button class="back-button" data-target="assignment-hub-page">חזרה למשימות</button>
            <div id="task-content">
                </div>
        </section>
        
        <section id="quiz-page" class="page hidden">
             <div id="quiz-container">
                <div id="quiz-progress"></div>
                <div id="quiz-question" class="ltr"></div>
                <div id="quiz-options"></div>
                <div id="quiz-feedback"></div>
                <button id="quiz-next-btn" class="action-button hidden">המשך</button>
            </div>
        </section>

        <section id="abc-audio-page" class="page hidden">
            <button class="back-button" data-target="assignment-hub-page">חזרה למשימות</button>
            <h1>האותיות</h1>
            <div id="abc-audio-content" class="text-passage">
                <p>(שימוש באוזניות או קול חיצוני הוא נדרש בשביל החלק הזה.)</p>
                <div id="audio-players-container" class="audio-players-container"></div>
                <button id="abc-audio-continue" class_name="action-button hidden">המשך</button>
            </div>
        </section>
        
        <section id="sentence-builder-page" class="page hidden">
            <button class="back-button" data-target="assignment-hub-page">חזרה למשימות</button>
            <h1>בניית משפט</h1>
            <div class="text-passage">
                <div id="built-sentence-container"></div>
                <div id="word-options" class="quiz-options"></div>
                <p id="sentence-feedback" class="quiz-feedback"></p>
            </div>
        </section>

    </div> <script>
    document.addEventListener('DOMContentLoaded', () => {
        
        // --- YOUTUBE CONFIGURATION ---
        // ----------------------------------------------------
        // --- !!! EDIT THIS SECTION FOR YOUTUBE VIDEOS !!! ---
        // ----------------------------------------------------
        // I have added the 6 links you provided.
        const youtubeLinks = {
            "abc-video": { title: "סרטון ABC", url: "https://www.youtube.com/embed/BELlZKpi1Zs" },
            "1": { title: "סרטון 1", url: "https://www.youtube.com/embed/3z4TQfNiqLc" },
            "2": { title: "סרטון 2", url: "https://www.youtube.com/embed/erLktxdLIWU" },
            "3": { title: "סרטון 3", url: "https://www.youtube.com/embed/hKIpbGK3fSM" },
            "4": { title: "סרטון 4", url: "https://www.youtube.com/embed/DuEM_d2GGF8" },
            "5": { title: "סרטון 5", url: "https://www.youtube.com/embed/8r_JUSXBQXA" },
            "6": { title: "סרטון 6", url: "https://www.youtube.com/embed/W4hPBfuabkM" },
            "7": { title: "סרטון 7", url: "https://www.youtube.com/embed/your-video-id-7" },
            "8": { title: "סרטון 8", url: "https://www.youtube.com/embed/your-video-id-8" },
            "9": { title: "סרטון 9", url: "https://www.youtube.com/embed/your-video-id-9" },
            "10": { title: "סרטון 10", url: "https://www.youtube.com/embed/your-video-id-10" },
            "11": { title: "סרטון 11", url: "https://www.youtube.com/embed/your-video-id-11" },
            "12": { title: "סרטון 12", url: "https://www.youtube.com/embed/your-video-id-12" },
            "13": { title: "סרטון 13", url: "https://www.youtube.com/embed/your-video-id-13" },
            "14": { title: "סרטון 14", url: "https://www.youtube.com/embed/your-video-id-14" },
            "15": { title: "סרטון 15", url: "https://www.youtube.com/embed/your-video-id-15" },
            "16": { title: "סרטון 16", url: "https://www.youtube.com/embed/your-video-id-16" },
            "17": { title: "סרטון 17", url: "https://www.youtube.com/embed/your-video-id-17" },
            "18": { title: "סרטון 18", url: "https://www.youtube.com/embed/your-video-id-18" },
            "19": { title: "סרטון 19", url: "https://www.youtube.com/embed/your-video-id-19" },
            "20": { title: "סרטון 20", url: "https://www.youtube.com/embed/your-video-id-20" },
            "21": { title: "סרטון 21", url: "https://www.youtube.com/embed/your-video-id-21" },
            "22": { title: "סרטון 22", url: "https://www.youtube.com/embed/your-video-id-22" },
            "23": { title: "סרטון 23", url: "https://www.youtube.com/embed/your-video-id-23" },
            "24": { title: "סרטון 24", url: "https://www.youtube.com/embed/your-video-id-24" },
            "25": { title: "סרטון 25", url: "https://www.youtube.com/embed/your-video-id-25" },
            "26": { title: "סרטון 26", url: "https://www.youtube.com/embed/your-video-id-26" },
            "27": { title: "סרטון 27", url: "https://www.youtube.com/embed/your-video-id-27" },
            "28": { title: "סרטון 28", url: "https://www.youtube.com/embed/your-video-id-28" },
            "29": { title: "סרטון 29", url: "https://www.youtube.com/embed/your-video-id-29" },
            "30": { title: "סרטון 30", url: "https://www.youtube.com/embed/your-video-id-30" },
            "31": { title: "סרטון 31", url: "https://www.youtube.com/embed/your-video-id-31" },
            "32": { title: "סרטון 32", url: "https://www.youtube.com/embed/your-video-id-32" },
            "33": { title: "סרטון 33", url: "https://www.youtube.com/embed/your-video-id-33" },
            "34": { title: "סרטון 34", url: "https://www.youtube.com/embed/your-video-id-34" },
            "35": { title: "סרטון 35", url: "https://www.youtube.com/embed/your-video-id-35" },
            "36": { title: "סרטון 36", url: "https://www.youtube.com/embed/your-video-id-36" },
        };
        // ----------------------------------------------------
        // --- END OF EDITABLE SECTIONS ---
        // ----------------------------------------------------


        // --- STATE MANAGEMENT ---
        let appState = {
            currentPage: 'home-page',
            completedAssignments: JSON.parse(localStorage.getItem('completedAssignments')) || []
        };
        
        // --- DOM ELEMENTS ---
        const app = document.getElementById('app');
        const allPages = document.querySelectorAll('.page');
        const taskPageContent = document.getElementById('task-content');

        // --- NAVIGATION ---
        function showPage(pageId) {
            allPages.forEach(page => {
                page.classList.add('hidden');
            });
            const pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.classList.remove('hidden');
                appState.currentPage = pageId;
                window.scrollTo(0, 0);
            }
            
            // Special logic
            if (pageId === 'assignment-hub-page') {
                updateAssignmentHub();
            }
        }

        // Main navigation (top bar)
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => {
                const targetPage = button.dataset.target;
                showPage(targetPage);
            });
        });

        // Back buttons
        document.querySelectorAll('.back-button').forEach(button => {
            button.addEventListener('click', () => {
                const targetPage = button.dataset.target;
                showPage(targetPage);
            });
        });
        
        // Home page "כניסה" button
        document.getElementById('login-button').addEventListener('click', () => {
            showPage('assignment-hub-page');
        });

        // --- ASSIGNMENT HUB ---
        function updateAssignmentHub() {
            document.querySelectorAll('.assignment-box').forEach(box => {
                const assignmentId = box.dataset.assignment;
                if (appState.completedAssignments.includes(assignmentId)) {
                    box.classList.add('completed');
                } else {
                    box.classList.remove('completed');
                }
            });
        }

        document.querySelectorAll('.assignment-box').forEach(box => {
            box.addEventListener('click', () => {
                const assignmentId = box.dataset.assignment;
                startAssignment(assignmentId);
            });
        });

        function markAssignmentAsCompleted(assignmentId) {
            if (!appState.completedAssignments.includes(assignmentId)) {
                appState.completedAssignments.push(assignmentId);
                localStorage.setItem('completedAssignments', JSON.stringify(appState.completedAssignments));
            }
        }

        // --- YOUTUBE PAGE ---
        function initYouTubePage() {
            const grid = document.querySelector('#youtube-page .youtube-grid');
            grid.innerHTML = ''; // Clear old buttons
            // Start from 1, skip "abc-video"
            for (let i = 1; i <= 36; i++) {
                const video = youtubeLinks[i.toString()];
                if (video) {
                    const button = document.createElement('button');
                    button.className = 'action-button';
                    button.textContent = video.title;
                    button.dataset.url = video.url;
                    button.dataset.title = video.title;
                    button.addEventListener('click', () => {
                        playVideo(video.url, video.title);
                    });
                    grid.appendChild(button);
                }
            }
        }

        function playVideo(url, title) {
            document.getElementById('video-player-title').textContent = title;
            document.getElementById('youtube-iframe').src = url;
            showPage('video-player-page');
        }

        // Stop video when going back
        document.querySelector('#video-player-page .back-button').addEventListener('click', () => {
            document.getElementById('youtube-iframe').src = ''; // Stop video
        });
        
        // --- TASK & ASSIGNMENT LOADER ---
        
        function startAssignment(assignmentId) {
            // Clear previous content
            taskPageContent.innerHTML = '';
            
            let content = `<h1>${getAssignmentTitle(assignmentId)}</h1>`;
            
            switch(assignmentId) {
                // --- Original Assignments ---
                case 'abc':
                    content += `<p>בחר שלב בלימוד ה-ABC:</p>`;
                    content += `<button class="action-button" id="abc-video-btn">שלב 1: צפה בסרטון</button>`;
                    content += `<button class="action-button" id="abc-audio-btn">שלב 2: האזן לאותיות</button>`;
                    content += `<button class="action-button" id="abc-special-btn">שלב 3: מקרים מיוחדים</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="abcQuiz">שלב 4: בוא נתרגל</button>`;
                    showPage('task-page');
                    
                    document.getElementById('abc-video-btn').addEventListener('click', () => {
                        const video = youtubeLinks['abc-video'];
                        playVideo(video.url, video.title);
                    });
                    document.getElementById('abc-audio-btn').addEventListener('click', () => {
                        createAbcAudioPage();
                        showPage('abc-audio-page');
                    });
                    document.getElementById('abc-special-btn').addEventListener('click', () => {
                        createAbcSpecialCasesPage(assignmentId);
                    });
                    break;
                
                case 'verbs':
                    content += `<p>בחר שלב בלימוד פעלים:</p>`;
                    content += `<button class="action-button" id="verbs-table-btn">שלב 1: טבלת פעלים</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="verbs1">שלב 2: תרגול פעלים</button>`;
                    content += `<button class="action-button" id="verbs-sentence-btn">שלב 3: בניית משפט</button>`;
                    showPage('task-page');
                    
                    document.getElementById('verbs-table-btn').addEventListener('click', createVerbsTablePage);
                    document.getElementById('verbs-sentence-btn').addEventListener('click', () => {
                        createSentenceBuilderPage(assignmentId);
                        showPage('sentence-builder-page');
                    });
                    break;
                    
                case 'future-simple':
                    content += `<p>בחר שלב בלימוד עתיד פשוט:</p>`;
                    content += `<button class="action-button" id="future-simple-expl-btn">שלב 1: הסבר</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="futureSimple1">שלב 2: תרגיל 1 (will/would)</button>`;
                    content += `<button class="action-button" id="future-simple-expl2-btn">שלב 3: הסבר (שלילה)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="futureSimple2">שלב 4: תרגיל 2 (wont/wouldn't)</button>`;
                    showPage('task-page');
                    
                    document.getElementById('future-simple-expl-btn').addEventListener('click', createFutureSimpleExplanationPage);
                    document.getElementById('future-simple-expl2-btn').addEventListener('click', createFutureSimpleExplanationPage2);
                    break;
                    
                case 'simple-past':
                    content += `<p>בחר שלב בלימוד עבר פשוט:</p>`;
                    content += `<button class="action-button" id="simple-past-expl-btn">שלב 1: הסבר מקיף</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="simplePastQuiz">שלב 2: בוא נתרגל</button>`;
                    showPage('task-page');
                    
                    document.getElementById('simple-past-expl-btn').addEventListener('click', () => {
                        createSimplePastExplanationPage(assignmentId);
                    });
                    break;

                // --- PDF/DOCX Assignments ---
                case 'reading':
                    content += `<p>בחר את רמת הקריאה לתרגול:</p>`;
                    content += `<button class="action-button task-start-btn" data-quiz="reading1">רמה 1 (כיתה ב)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="reading2">רמה 2 (כיתה ג)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="reading3">רמה 3 (כיתה ד)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="reading4">רמה 4 (כיתה ה)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="reading5">רמה 5 (כיתה ו)</button>`;
                    showPage('task-page');
                    break;
                    
                case 'grammar':
                    content += `<p>בחר את הנושא לתרגול:</p>`;
                    content += `<button class="action-button task-start-btn" data-quiz="whQuestions">שאלות WH (השלם את החסר)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="prepositions">מילות יחס (Prepositions)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="presentSimple1">Present Simple - s/es/ies</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="presentSimple2">Present Simple - Don't / Doesn't</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="presentSimple3">Present Simple - Do / Does</button>`;
                    showPage('task-page');
                    break;
                    
                case 'writing':
                    content += `<p>במשימה זו תלמדו לתאר אובייקטים, להשוות ביניהם ולכתוב פסקאות טיעון. המשימה מבוססת על קובץ הכתיבה שסיפקת.</p>`;
                    content += `<h2>שלב 1: תיאור לימון</h2><p class="ltr">A lemon is a yellow fruit. It is often oval in shape. It tastes sour. It has a bright color and a textured rind.</p>`;
                    content += `<h2>שלב 2: השוואת בתים</h2><p class="ltr">The first picture shows a traditional, stone house with a calm feeling. The second picture shows a funny, upside-down red house. The first house is normal, while the second house is an unusual tourist attraction.</p>`;
                    content += `<h2>שלב 3: תיאור והשוואת עטים</h2><p class="ltr">The first pen is a fancy, red and gold fountain pen. It looks very expensive and decorative. The second pen is a simple, modern, blue ballpoint pen. It looks sleek and practical. The main difference is style: one is classic and ornate, the other is modern and minimalist.</p>`;
                    content += `<h2>שלב 4: תיאור רגשות</h2><p class="ltr">The first man (with steam) looks extremely angry or furious. The second man (with fists) looks very happy and triumphant. The third man (crying) looks very sad or distressed.</p>`;
                    content += `<h2>שלב 5: פסקת טיעון (6 או 9)</h2><p class="ltr">In the picture, two boys are looking at a number on the floor. From one boy's perspective, it looks like the number 6. From the other boy's perspective, it looks like the number 9. This picture shows that both boys are 'right' based on their point of view. It teaches us that perspective is important and people can see the same thing differently.</p>`;
                    content += `<h2>שלב 6: תיאור חוויה</h2><p>כדי לתאר חוויה, עקבו אחר הצעדים הבאים: 1. כותרת. 2. פתיחה (על מה אספר?). 3. גוף הסיפור (מה קרה? מה ראיתי? מה הרגשתי?). 4. סיבה (למה בחרתי בחוויה זו?). 5. סיום (מה מיוחד? המלצה?).</p>`;
                    content += `<br><button class="action-button" id="complete-writing-btn">סיימתי לקרוא</button>`;
                    showPage('task-page');
                    
                    document.getElementById('complete-writing-btn').addEventListener('click', () => {
                        markAssignmentAsCompleted('writing');
                        showPage('assignment-hub-page');
                    });
                    break;
                    
                case 'speaking':
                    content += `<p>במשימה זו תתרגלו זיהוי שגיאות וקריאה בקול.</p>`;
                    content += `<h2>טקסט לקריאה (Lvl 3)</h2><div class="text-passage ltr"><h3>The Strength Within</h3><p>Once upon a time in a small village, there lived a girl named Mia. She was like any other girl, with dreams, hopes, and a heart full of kindness. Every morning, she would tie her hair into a pony tail and slip on her favorite blue slippers before heading to her High school...</p><p>(המשך הטקסט מקובץ ה-PDF שלך...)</p></div>`;
                    content += `<button class="action-button task-start-btn" data-quiz="speaking1">התחל תרגיל זיהוי שגיאות (Lvl 1)</button>`;
                    content += `<button class="action-button task-start-btn" data-quiz="speaking2">התחל תרגיל זיהוי שגיאות (Lvl 2)</button>`;
                    showPage('task-page');
                    break;
                    
                case 'adjectives':
                    content += `<p>לימוד ותרגול שמות תואר (Adjectives) ותואר הפועל (Adverbs).</p>`;
                    content += `<h2>כללים בסיסיים</h2><div class="text-passage ltr"><p>Adjectives describe nouns (e.g., tall man, beautiful day).</p><p>To compare (bigger): add 'er' (taller) or use 'more' for long words (more beautiful).</p><p>For 'the most' (biggest): add 'est' (tallest) or use 'most' (most beautiful).</p><p>Adverbs describe verbs (e.g., run quickly, eat slowly). They often end in -ly.</p></div>`;
                    content += `<button class="action-button task-start-btn" data-quiz="adjectivesQuiz">התחל תרגול</button>`;
                    showPage('task-page');
                    break;
            }
            
            // Add event listeners for the new quiz buttons
            document.querySelectorAll('.task-start-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    startQuiz(btn.dataset.quiz, assignmentId);
                });
            });
        }
        
        function getAssignmentTitle(assignmentId) {
            const titles = {
                'reading': 'קריאה',
                'grammar': 'דקדוק',
                'writing': 'כתיבה',
                'speaking': 'דיבור',
                'adjectives': 'שמות תואר',
                'abc': 'ה-ABC האנגלי',
                'verbs': 'פעלים',
                'future-simple': 'עתיד פשוט',
                'simple-past': 'עבר פשוט'
            };
            return titles[assignmentId] || 'משימה';
        }

        // --- HELPER FUNCTIONS FOR ORIGINAL ASSIGNMENTS ---

        function createChainedContentPage(assignmentId, steps, onComplete) {
            let currentStep = 0;
            taskPageContent.innerHTML = `<h1>${getAssignmentTitle(assignmentId)}</h1>`;
            
            function loadStep() {
                const step = steps[currentStep];
                let html = '<div class="text-passage">';
                if (step.title) html += `<h2>${step.title}</h2>`;
                if (step.text) html += `<p>${step.text.replace(/\n/g, '<br>')}</p>`;
                if (step.content) html += step.content;
                html += `<button class="action-button" id="chain-next-btn">${step.button}</button>`;
                html += '</div>';
                
                taskPageContent.innerHTML = `<h1>${getAssignmentTitle(assignmentId)}</h1>${html}`;
                
                document.getElementById('chain-next-btn').addEventListener('click', () => {
                    currentStep++;
                    if (currentStep < steps.length) {
                        loadStep();
                    } else {
                        onComplete();
                    }
                }, { once: true });
            }
            loadStep();
            showPage('task-page');
        }

        function createAbcSpecialCasesPage(assignmentId) {
            const steps = [
                { title: "אותיות שורקות", text: "האותיות השורקות הם מקרה מיוחד של שילוב אותיות שיוצרות צלילים שונים, שגם יכולים לחקות אותיות מסוימות.", button: "המשך" },
                { title: "E הקסומה", text: 'e בסוף מילה נקראת "magic e" כיוון שהיא גורמת לאות הניקוד שבאה לפניה לשנות את הצליל, כך שהוא נשמע כמו השם שלה ולאחר מכן הצליל נשמע ארוך יותר.', button: "המשך" },
                { title: "אותיות ניקוד", text: "מספר אותיות הניקוד במילה משפיע על הצליל שלהן כאשר יש למילה אות ניקוד אחת, הצליל של האות הניקוד יהיה קצר.\nכאשר יש למילה יותר מאות ניקוד אחת, הצליל של האות הניקוד יהיה ארוך ומעוגל יותר", button: "המשך" },
                { title: "אותיות שקטות", text: "אותיות שותקות אלו אותיות שיופיע כחלק מהמילה עצמה וחייבות להכתב עם המילה אך הן אינן מושמעות בהגיית המילה", button: "המשך למשימה" }
            ];
            createChainedContentPage(assignmentId, steps, () => {
                startQuiz('abcQuiz', assignmentId);
            });
        }
        
        function createSimplePastExplanationPage(assignmentId) {
            const steps = [
                { text: "הזמן הפשוט הוא היבט בסיסי של דקדוק האנגלית המשמש לתיאור פעולות שהושלמו בעבר. הנה כמה כללים חשובים המתארים את השימוש בו", button: "המשך" },
                { text: 'פעלים רגילים: עבור פעלים רגילים, עבר פשוט נוצר על ידי הוספת "-ed" לצורת הבסיס של הפועל.\nכלל זה חל על רוב הפעלים.\n- Watch → watched (צופה ←צפה)\n- ask → asked (שואל ← שאל)\n-clean → cleaned (מנקה ← ניקה)', button: "המשך" },
                { text: 'אם הפועל מסתיים באות e מוסיפים רק את האות "d" ולא "ed", דוגמאות:\n- like → liked (מחבב ← חיבב)\n- arrive → arrived\n- decide → decided', button: "המשך" },
                { text: 'אם הפועל מסתיים באות עיצור, אות ניקוד, אות עיצור (cvc), הכפל את האות האחרונה האחרון לפני הוספת "-ed". אך אם במילה יש יותר מהעברה אחת אז cvc לא מתקיים.\nחוץ מכמה יוצאי דופן שלא מכפילים כגון: x,y,w ולפעמים k.\nדוגמאות למילים:\n- play → played (משחק ← שיחק)\n- stop → stopped (עצור ← עצר)', button: "המשך" },
                { text: "פעלים לא רגילים: בניגוד לכך, פעלים לא סדירים אינם פועלים לפי תבנית קבועה כאשר יוצרים את זמן העבר שלהם. לכן, חשוב לזכור את הצורות העבריות של הפעלים הללו.\nדוגמאות למילים:\n- go → went (הולך ← הלך)\n- see → saw (רואה ← ראה)\n- eat → ate (אוכל ← אכל)\n- know → knew (יודע ← ידע)", button: "המשך" },
                { text: 'משפטים שליליים: כדי ליצור משפטים שליליים בזמן עבר פשוט, השתמשו ב-"did not" (או הצורה המקוצרת "didn\'t") ואחריה הצורה הבסיסית של הפועל.\nמבנה זה מעביר ביעילות שהפעולה לא התרחשה בעבר.\nדוגמאות למשפטים:\n- I didn\'t walk to school today. (אני לא הלכתי לבית ספר היום)\n- She didn\'t finish her homework. (היא לא סיימה את שיעורי הבית שלה)', button: "המשך" },
                { text: 'שאלות: כאשר יוצרים שאלות בזמן עבר פשוט, התחילו ב-"Did" או ב-"Were" או ב-"Was", ואחריו הנושא וצורת הבסיס של הפועל.\nפורמט זה חיוני להשגת מידע על פעולות בעבר.\nדוגמאות:\n1.What did you do yesterday? (מה עשית אתמול?)\n2.Where did you go last weekend? (לאן הלכת בסוף השבוע האחרון?)\n3.Did you play any sports last week? (האם שיחקת בספורט בשבוע שעבר?)', button: "המשך למשימה" },
            ];
            createChainedContentPage(assignmentId, steps, () => {
                startQuiz('simplePastQuiz', assignmentId);
            });
        }
        
        function createFutureSimpleExplanationPage() {
            taskPageContent.innerHTML = `<h1>עתיד פשוט</h1>
            <div class="text-passage">
                <p>זמן עתיד הוא זמן פשוט להבנה.
                כל הגופים משתמשים ב- will ו- would, אך מה ההבדל ביניהם?
                <br> משתמשים ב- will כאשר אנחנו רוצים להגיד משהו שקשור אך ורק לעתיד, ואילו משתמשים ב- would כאשר משהו נאמר בעבר אבל אמור להתרחש בעתיד.
                יש פעמים שמשתמשים ב- would כדי לבטא בקשה מנומסת שתתרחש לרוב בעתיד.
                חשוב לזכור ש would זה לא תחליף ל- will. <br> בוא נתרגל את מה שלמדנו:</p>
                <button class="action-button task-start-btn" data-quiz="futureSimple1">התחל תרגיל 1</button>
            </div>`;
            showPage('task-page');
            // Re-add listener since we overwrote the page
            document.querySelector('.task-start-btn').addEventListener('click', (e) => {
                startQuiz(e.target.dataset.quiz, 'future-simple');
            });
        }
        
        function createFutureSimpleExplanationPage2() {
            taskPageContent.innerHTML = `<h1>עתיד פשוט - שלילה</h1>
            <div class="text-passage">
                <p>נכון שיש לנו את הגופים?
                אז כאשר אנחנו רוצים לכתוב את המשפט בצורה שלילית, במקום will ו- would משתמשים ב- wont ו- wouldn't.
                הם מייצגים would-not ו- will not. <br> בוא נתרגל את הנושא הזה.</p>
                <button class="action-button task-start-btn" data-quiz="futureSimple2">התחל תרגיל 2</button>
            </div>`;
            showPage('task-page');
            // Re-add listener
            document.querySelector('.task-start-btn').addEventListener('click', (e) => {
                startQuiz(e.target.dataset.quiz, 'future-simple');
            });
        }

        function createVerbsTablePage() {
            const verbs = [
                ["Eat", "לאכול"], ["drink", "לשתות"], ["walk", "ללכת"], ["run", "לרוץ"],
                ["sit", "לשבת"], ["lie", "לשכב"], ["stand", "לעמוד"], ["fall", "ליפול"],
                ["laugh", "לצחוק"], ["speak", "לדבר"], ["cry", "לבכות"], ["answer", "לענות"],
                ["ask", "לשאול"], ["see", "לראות"], ["hear", "לשמוע"], ["break", "לשבור"],
                ["feel", "להרגיש"], ["fix", "לתקן"], ["drive", "לנהוג"], ["ride", "לרכב"],
                ["swim", "לשחות"], ["jump", "לקפוץ"], ["climb", "לטפס"], ["fly", "לעוף"],
                ["push", "לדחוף"], ["pull", "למשוך"], ["throw", "לזרוק"], ["catch", "לתפוס"],
                ["cut", "לחתוך"], ["cook", "לבשל"]
            ];
            let gridHtml = `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;text-align:center;font-size:1.1em;">
                            <div><b>באנגלית</b></div><div><b>תרגום</b></div>`;
            verbs.forEach(([en, he]) => {
                gridHtml += `<div dir="ltr">${en}</div><div dir="rtl">${he}</div>`;
            });
            gridHtml += `</div><button class="action-button task-start-btn" data-quiz="verbs1" style="margin-top:20px;">לתרגול</button>`;
            
            taskPageContent.innerHTML = `<h1>טבלת פעלים</h1><div class="text-passage">${gridHtml}</div>`;
            showPage('task-page');
            // Re-add listener
            document.querySelector('.task-start-btn').addEventListener('click', (e) => {
                startQuiz(e.target.dataset.quiz, 'verbs');
            });
        }
        
        function createAbcAudioPage() {
            const container = document.getElementById('audio-players-container');
            container.innerHTML = ''; // Clear previous
            const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
            
            letters.forEach(letter => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'audio-player';
                // !!! NOTE: You need to have audio files named a.mp3, b.mp3, etc. in a folder or URL path !!!
                playerDiv.innerHTML = `
                    <h3>האות ${letter.toUpperCase()}</h3>
                    <audio controls>
                        <source src="path/to/${letter}.mp3" type="audio/mpeg">
                      Your browser does not support the audio element.
                    </audio>
                `;
                container.appendChild(playerDiv);
            });
        }
        
        function createSentenceBuilderPage(assignmentId) {
            const correctOrder = ["He", "won't", "go", "to", "the", "mall", "tomorrow"];
            const words = ["won't", "tomorrow", "apple", "mall", "He", "to", "rise", "go", "the"].sort(() => Math.random() - 0.5);
            const incorrectWords = ["apple", "rise"];
            let builtSentence = [];

            const sentenceEl = document.getElementById('built-sentence-container');
            const optionsEl = document.getElementById('word-options');
            const feedbackEl = document.getElementById('sentence-feedback');
            
            sentenceEl.innerHTML = '';
            optionsEl.innerHTML = '';
            feedbackEl.innerHTML = '';

            function renderWords() {
                optionsEl.innerHTML = '';
                words.forEach(word => {
                    const button = document.createElement('button');
                    button.className = 'quiz-option-btn';
                    button.textContent = word;
                    button.onclick = () => handleWordClick(word, button);
                    optionsEl.appendChild(button);
                });
            }

            function handleWordClick(word, button) {
                feedbackEl.textContent = '';
                if (incorrectWords.includes(word)) {
                    feedbackEl.textContent = 'המילה הזו לא שייכת למשפט!';
                    feedbackEl.className = 'quiz-feedback incorrect';
                    button.classList.add('incorrect');
                    button.disabled = true;
                    return;
                }

                const nextCorrectWord = correctOrder[builtSentence.length];
                if (word === nextCorrectWord) {
                    builtSentence.push(word);
                    sentenceEl.textContent = builtSentence.join(' ');
                    button.classList.add('correct');
                    button.disabled = true;
                    
                    if (builtSentence.length === correctOrder.length) {
                        feedbackEl.textContent = 'עבודה טובה!';
                        feedbackEl.className = 'quiz-feedback correct';
                        markAssignmentAsCompleted(assignmentId);
                    }
                } else {
                    const prevWord = builtSentence.length > 0 ? builtSentence[builtSentence.length - 1] : 'התחלה';
                    feedbackEl.textContent = `המילה הזו לא באה אחרי "${prevWord}", חשבו על מילה אחרת`;
                    feedbackEl.className = 'quiz-feedback incorrect';
                    button.classList.add('incorrect');
                    setTimeout(() => button.classList.remove('incorrect'), 500);
                }
            }
            renderWords();
        }

        // --- QUIZ ENGINE ---
        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let wrongAnswers = [];
        let isReviewRound = false;
        let currentQuizId = '';
        let parentAssignmentId = '';

        const quizContainer = document.getElementById('quiz-container');
        const questionEl = document.getElementById('quiz-question');
        const optionsEl = document.getElementById('quiz-options');
        const feedbackEl = document.getElementById('quiz-feedback');
        let nextBtn = document.getElementById('quiz-next-btn');

        function startQuiz(quizId, assignmentId) {
            currentQuizId = quizId;
            parentAssignmentId = assignmentId;
            currentQuiz = shuffleArray([...quizData[quizId]]); // Get a shuffled copy
            currentQuestionIndex = 0;
            wrongAnswers = [];
            isReviewRound = false;
            
            // Add back button to quiz page
            const existingBackBtn = document.querySelector('#quiz-page .back-button');
            if (existingBackBtn) {
                existingBackBtn.remove(); // Remove old one if it exists
            }
            
            const backBtn = document.createElement('button');
            backBtn.className = 'back-button';
            backBtn.textContent = 'חזרה למשימות';
            backBtn.dataset.target = 'assignment-hub-page';
            backBtn.addEventListener('click', () => showPage('assignment-hub-page'));
            document.getElementById('quiz-page').prepend(backBtn);
            
            showPage('quiz-page');
            loadQuestion();
        }

        function loadQuestion() {
            // Clear previous state
            feedbackEl.textContent = '';
            feedbackEl.className = '';
            nextBtn.classList.add('hidden');
            optionsEl.innerHTML = '';
            
            // Re-bind nextBtn in case it was replaced
            nextBtn = document.getElementById('quiz-next-btn');
            nextBtn.removeEventListener('click', nextQuestionHandler);
            nextBtn.addEventListener('click', nextQuestionHandler);


            if (currentQuestionIndex >= currentQuiz.length) {
                finishQuiz();
                return;
            }

            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('quiz-progress').textContent = `שאלה ${currentQuestionIndex + 1} מתוך ${currentQuiz.length}`;
            questionEl.textContent = question.q;
            
            // Ensure LTR/RTL direction
            if (/[a-zA-Z]/.test(question.q)) { // If question contains English
                 questionEl.className = 'ltr';
            } else {
                 questionEl.className = 'rtl';
            }

            const options = shuffleArray([...question.o]); // Shuffle options
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'quiz-option-btn';
                button.textContent = option;
                
                if (/[a-zA-Z]/.test(option)) { // If option contains English
                    button.classList.add('ltr');
                } else {
                    button.classList.add('rtl');
                }
                
                button.addEventListener('click', () => selectAnswer(button, option, question.a));
                optionsEl.appendChild(button);
            });
        }
        
        function nextQuestionHandler() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function selectAnswer(button, selectedOption, correctAnswer) {
            // Disable all buttons
            optionsEl.querySelectorAll('.quiz-option-btn').forEach(btn => {
                btn.disabled = true;
                // Highlight correct/incorrect
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedOption) {
                    btn.classList.add('incorrect');
                }
            });

            if (selectedOption === correctAnswer) {
                feedbackEl.textContent = 'תשובה נכונה!';
                feedbackEl.className = 'correct';
            } else {
                feedbackEl.textContent = `תשובה שגויה. הנכונה היא: ${correctAnswer}`;
                feedbackEl.className = 'incorrect';
                // Add to wrong answers list
                if (!isReviewRound) {
                    // Only add if it's not already in the list
                    if (!wrongAnswers.includes(currentQuiz[currentQuestionIndex])) {
                         wrongAnswers.push(currentQuiz[currentQuestionIndex]);
                    }
                }
            }

            nextBtn.classList.remove('hidden');
        }

        function finishQuiz() {
            if (wrongAnswers.length > 0 && !isReviewRound) {
                // Start review round
                isReviewRound = true;
                currentQuiz = shuffleArray([...wrongAnswers]);
                wrongAnswers = []; // Clear for the next round
                currentQuestionIndex = 0;
                questionEl.textContent = 'בואו נעבור שוב על הטעויות...';
                optionsEl.innerHTML = '';
                feedbackEl.textContent = '';
                
                nextBtn.textContent = 'התחל סבב תיקון';
                nextBtn.classList.remove('hidden');
                
                // Use a one-time listener for "Start Review"
                nextBtn.removeEventListener('click', nextQuestionHandler);
                nextBtn.addEventListener('click', loadQuestion, { once: true });


            } else {
                // Quiz truly finished
                questionEl.textContent = 'כל הכבוד! סיימת את המשימה.';
                optionsEl.innerHTML = '';
                feedbackEl.textContent = (isReviewRound && wrongAnswers.length > 0) ? 'עדיין יש כמה טעויות, נסו שוב מאוחר יותר.' : '';
                
                nextBtn.textContent = 'חזור למשימות';
                nextBtn.classList.remove('hidden');
                
                // Use a one-time listener for "Back to Hub"
                nextBtn.removeEventListener('click', nextQuestionHandler);
                nextBtn.addEventListener('click', () => {
                    checkAssignmentCompletion();
                    showPage('assignment-hub-page');
                }, { once: true });
            }
        }
        
        function checkAssignmentCompletion() {
            // This is a simple completion check.
            // For multi-part assignments, it marks complete after any quiz.
            // You could add more complex logic here if needed.
            if (parentAssignmentId) {
                markAssignmentAsCompleted(parentAssignmentId);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        
        // --- QUIZ DATABASE (ALL ASSIGNMENTS) ---
        const quizData = {
            // --- Original Assignments ---
            'futureSimple1': [
                { q: "I __ go to the mall tomorrow", a: "will", o: ["will", "would", "כלום לא מתאים"] }, // Corrected from "כלום לא מתאים"
                { q: "___ your sister come to the movie theater tonight?", a: "will", o: ["will", "would", "כלום לא מתאים"] },
                { q: "How __ we go to the school event this weekend?", a: "will", o: ["will", "would", "כלום לא מתאים"] },
                { q: "__ you want to come to my house today?", a: "would", o: ["will", "would", "כלום לא מתאים"] },
                { q: "Ali __ take Maya to school tomorrow.", a: "will", o: ["will", "would", "כלום לא מתאים"] },
                { q: "My dog __ eat his food tonight.", a: "will", o: ["will", "would", "כלום לא מתאים"] },
                { q: "Tomorrow me and my family __ go to eat in a restaurant.", a: "will", o: ["will", "would", "כלום לא מתאים"] },
                { q: "__ you like to come to my house tomorrow?", a: "would", o: ["will", "would", "כלום לא מתאים"] }
            ],
            'futureSimple2': [
                 { q: "I __ eat fast food next week", a: "wont", o: ["wouldn't", "wont"] },
                 { q: "Noya is sick, she __ come to the party tonight", a: "wont", o: ["wouldn't", "wont"] },
                 { q: "My parents and I __ open our business tomorrow.", a: "wont", o: ["wouldn't", "wont"] }, // Corrected from wouldn't
                 { q: "My sister __ come to the trip next week.", a: "wont", o: ["wouldn't", "wont"] },
                 { q: "I think she __ like the present that I will give her next week.", a: "wont", o: ["wouldn't", "wont"] },
                 { q: "I think I __ be able to visit your family next week.", a: "wont", o: ["wouldn't", "wont"] }, // Corrected from wouldn't
                 { q: "I ___ do that if I were you.", a: "wouldn't", o: ["wouldn't", "wont"] }
            ],
            'verbs1': [
                { q: 'מה המשמעות של "jump"?', a: 'לקפוץ', o: ['לשבת', 'לקפוץ', 'לחשוב'] },
                { q: 'מה המשמעות של "write"?', a: 'לכתוב', o: ['לקרוא', 'לכתוב', 'ללכת'] }, // This question was not in the original file but seems implied
                { q: 'אני __ מים כל יום', a: 'drink', o: ['cook', 'look', 'drink'] },
                { q: 'היא __ סיפור במחברתה', a: 'writes', o: ['writes', 'walks', 'runs'] },
                { q: 'אני __ לבית הספר כל יום', a: 'walk', o: ['learn', 'fish', 'walk'] },
                { q: 'היא __ לחנות', a: 'goes', o: ['teaches', 'climbs', 'goes'] },
                { q: 'אנחנו __ ארוחת ערב בשעה', a: 'eat', o: ['cook', 'eat', 'ride'] },
                { q: 'הוא __ ספר בספרייה', a: 'reads', o: ['lives', 'lies', 'reads'] }
            ],
            'abcQuiz': [
                { q: "איזה אות באה אחרי K?", a: "L", o: ["A", "L", "Z"] },
                { q: "איזה אות באה אחרי C?", a: "D", o: ["D", "Y", "M"] },
                { q: "איזה אות באה אחרי S?", a: "T", o: ["T", "C", "O"] },
                { q: "איזה אות באה אחרי W?", a: "X", o: ["K", "B", "X"] },
                { q: "איזה אות באה אחרי Q?", a: "R", o: ["R", "E", "L"] },
                { q: "מהי האות האחרונה בסדר האלף - בית באנגלית?", a: "Z", o: ["Q", "Z", "V"] },
                { q: "כמה אותיות יש באלף - בית של אנגלית?", a: "26", o: ["22", "23", "26"] }
            ],
            'simplePastQuiz': [
                { q: "She _____ (speak) to her boss about the project yesterday", a: "spoke", o: ["spoke", "speaks", "speaked"] },
                { q: "We _____ (drive) to the mountains last weekend", a: "drove", o: ["drived", "drive", "drove"] },
                { q: "The cat _____ (sleep) on the sofa all day", a: "slept", o: ["sleeping", "slept", "sleeped"] },
                { q: "I _____ (read) an interesting book last month", a: "read", o: ["read", "readen", "readed"] }, // 'read' (pronounced 'red')
                { q: "They _____ (swim) in the lake during their vacation", a: "swam", o: ["swimming", "swom", "swam"] },
                { q: "He _____ (break) his arm while skiing two weeks ago", a: "broke", o: ["breaking", "broke", "breaken"] },
                { q: "The children _____ (bake) cookies with their grandmother", a: "baked", o: ["baked", "bake", "baking"] },
                { q: "We _____ (fly) to Paris for our anniversary last year", a: "flew", o: ["flought", "flying", "flew"] },
                { q: "The teacher _____ (give) us a lot of homework yesterday", a: "gave", o: ["gave", "given", "giving"] },
                { q: "I _____ (lose) my keys at the supermarket this morning", a: "lost", o: ["lose", "losing", "lost"] },
                { q: "She _____ (dance) beautifully at the party last night", a: "danced", o: ["dancing", "danced", "donce"] },
                { q: "They _____ (build) a treehouse in their backyard last summer", a: "built", o: ["built", "building", "build"] },
                { q: "He _____ (tell) us an exciting story about his travels", a: "told", o: ["told", "telling", "telled"] },
                { q: "We _____ (meet) our new neighbors at the community barbecue", a: "met", o: ["meeting", "met", "meet"] },
                { q: "The movie _____ (begin) late because of technical issue", a: "began", o: ["begginning", "begin", "began"] } // Corrected from begun
            ],
            
            // --- PDF/DOCX Assignments ---
            'whQuestions': [
                { q: "___ are you going to the party tonight? (When)", o: ["When", "Where", "Who"], a: "When" },
                { q: "___ is your favorite color?", o: ["What", "Where", "Who"], a: "What" },
                { q: "___ does she live?", o: ["When", "Where", "Why"], a: "Where" },
                { q: "___ is the capital of France?", o: ["Who", "What", "Why"], a: "What" },
                { q: "___ do you usually do on weekends?", o: ["What", "Where", "Who"], a: "What" },
                { q: "___ is your brother's name?", o: ["What", "Why", "How"], a: "What" },
                { q: "___ did you arrive at the airport?", o: ["When", "Who", "What"], a: "When" },
                { q: "___ do you want for lunch?", o: ["Where", "What", "Why"], a: "What" },
                { q: "___ is your favorite movie?", o: ["What", "How", "Who"], a: "What" },
                { q: "___ do you study English?", o: ["Why", "Who", "What"], a: "Why" },
                { q: "___ are they coming to the meeting?", o: ["When", "Where", "What"], a: "When" },
                { q: "___ is your best friend?", o: ["What", "Who", "Why"], a: "Who" },
                { q: "___ is your birthday?", o: ["When", "Where", "How"], a: "When" },
                { q: "___ do you like to read?", o: ["What", "Why", "Who"], a: "What" },
                { q: "___ do you think of this idea?", o: ["What", "Who", "Where"], a: "What" }
            ],
            'prepositions': [
                { q: "The ball is ___ the table.", o: ["on", "under", "next to"], a: "on" }, 
                { q: "The cat is ___ the box.", o: ["in", "behind", "on"], a: "in" },
                { q: "The book is ___ the bed.", o: ["under", "in front of", "next to"], a: "under" },
                { q: "The chair is ___ the desk.", o: ["on", "behind", "under"], a: "behind" },
                { q: "The dog is ___ the door.", o: ["next to", "in", "on"], a: "next to" },
                { q: "The shoes are ___ the floor.", o: ["on", "under", "in front of"], a: "on" },
                { q: "The picture is ___ the wall.", o: ["in", "on", "under"], a: "on" },
                { q: "The boy is sitting ___ the chair.", o: ["under", "on", "next to"], a: "on" },
                { q: "The bag is ___ the table.", o: ["on", "in", "behind"], a: "on" },
                { q: "The bird is ___ the tree.", o: ["in", "under", "next to"], a: "in" },
                { q: "The toys are ___ the box.", o: ["in", "on", "behind"], a: "in" },
                { q: "The car is parked ___ the house.", o: ["next to", "behind", "in"], a: "next to" },
                { q: "The keys are ___ the drawer.", o: ["in", "on", "under"], a: "in" },
                { q: "The children are playing ___ the park.", o: ["in", "on", "behind"], a: "in" },
                { q: "The lamp is ___ the table, not under it.", o: ["on", "next to", "in"], a: "on" },
                { q: "The school bag is ___ the chair and the desk.", o: ["between", "next to", "under"], a: "between" },
                { q: "The clock is hanging ___ the wall above the TV.", o: ["on", "under", "in front of"], a: "on" },
                { q: "The cat is hiding ___ the sofa because it is scared.", o: ["behind", "on", "in"], a: "behind" },
                { q: "The books are neatly placed ___ the shelf.", o: ["on", "under", "in front of"], a: "on" },
                { q: "The bike is leaning ___ the wall in the garage.", o: ["next to", "on", "under"], a: "next to" } 
            ],
            'presentSimple1': [ // s/es/ies
                { q: "fix (he)", o: ["fixes", "fixs", "fixies"], a: "fixes" },
                { q: "watch (she)", o: ["watchs", "watches", "watchies"], a: "watches" },
                { q: "brush (he)", o: ["brushs", "brushes", "brushies"], a: "brushes" },
                { q: "tidy (she)", o: ["tidys", "tidies", "tidyes"], a: "tidies" },
                { q: "fly (it)", o: ["flys", "flyes", "flies"], a: "flies" },
                { q: "go (he)", o: ["gos", "goes", "goies"], a: "goes" },
                { q: "try (she)", o: ["trys", "tryes", "tries"], a: "tries" },
                { q: "find (he)", o: ["finds", "findes", "findies"], a: "finds" },
                { q: "feel (she)", o: ["feels", "feeles", "feelies"], a: "feels" },
                { q: "make (it)", o: ["makes", "makees", "makies"], a: "makes" },
                { q: "live (he)", o: ["lives", "livees", "livies"], a: "lives" },
                { q: "play (she)", o: ["plays", "playes", "plaies"], a: "plays" },
                { q: "sail (it)", o: ["sails", "sailes", "sailies"], a: "sails" },
                { q: "copy (he)", o: ["copys", "copyes", "copies"], a: "copies" },
                { q: "carry (she)", o: ["carrys", "carryes", "carries"], a: "carries" },
                { q: "do (he)", o: ["dos", "does", "doies"], a: "does" },
                { q: "hurry (she)", o: ["hurrys", "hurryes", "hurries"], a: "hurries" },
                { q: "wash (it)", o: ["washs", "washes", "washies"], a: "washes" }
            ],
            'presentSimple2': [ // Don't / Doesn't
                { q: "I ___ like chicken.", o: ["don't", "doesn't"], a: "don't" },
                { q: "My sister ___ eat pasta.", o: ["don't", "doesn't"], a: "doesn't" },
                { q: "You ___ buy apples.", o: ["don't", "doesn't"], a: "don't" },
                { q: "The dog ___ bark.", o: ["don't", "doesn't"], a: "doesn't" },
                { q: "My mum ___ read comics.", o: ["don't", "doesn't"], a: "doesn't" },
                { q: "Ann and I ___ go to school.", o: ["don't", "doesn't"], a: "don't" },
                { q: "Cows ___ live in the sea.", o: ["don't", "doesn't"], a: "don't" },
                { q: "They ___ play football.", o: ["don't", "doesn't"], a: "don't" },
                { q: "My cat ___ chase mice.", o: ["don't", "doesn't"], a: "doesn't" },
                { q: "Her friend ___ speak English.", o: ["don't", "doesn't"], a: "doesn't" },
                { q: "This man ___ smoke.", o: ["don't", "doesn't"], a: "doesn't" },
                { q: "It ___ run very fast.", o: ["don't", "doesn't"], a: "doesn't" }
            ],
            'presentSimple3': [ // Do / Does
                { q: "___ cats play football?", o: ["Do", "Does"], a: "Do" },
                { q: "___ Pamela Anderson have blonde hair?", o: ["Do", "Does"], a: "Does" },
                { q: "___ your girl/boyfriend like swimming?", o: ["Do", "Does"], a: "Does" },
                { q: "___ David Beckham play football for England?", o: ["Do", "Does"], a: "Does" },
                { q: "___ you want to come with me?", o: ["Do", "Does"], a: "Do" },
                { q: "___ he always do that?", o: ["Do", "Does"], a: "Does" },
                { q: "___ they like dogs?", o: ["Do", "Does"], a: "Do" },
                { q: "___ your father speak German?", o: ["Do", "Does"], a: "Does" },
                { q: "___ your wife/husband come from Argentina?", o: ["Do", "Does"], a: "Does" },
                { q: "___ Chileans like Tango?", o: ["Do", "Does"], a: "Do" },
                { q: "___ he sing in the shower?", o: ["Do", "Does"], a: "Does" },
                { q: "___ your grandmother have a dog?", o: ["Do", "Does"], a: "Does" },
                { q: "___ you want an ice cream?", o: ["Do", "Does"], a: "Do" },
                { q: "___ your friends like you?", o: ["Do", "Does"], a: "Do" },
                { q: "___ you have a lot of money?", o: ["Do", "Does"], a: "Do" }
            ],
            'speaking1': [ // Lvl 1
                { q: "Where is my friend house?", o: ["Where is my friend house?", "Where is my friend's house?"], a: "Where is my friend's house?" },
                { q: "Mike and Dan is going to the beach.", o: ["Mike and Dan is going...", "Mike and Dan are going..."], a: "Mike and Dan are going..." },
                { q: "I have five cat.", o: ["I have five cat.", "I have five cats."], a: "I have five cats." },
                { q: "Yesterday I were swimming.", o: ["Yesterday I were swimming.", "Yesterday I was swimming."], a: "Yesterday I was swimming." },
                { q: "I will go hiking in the sea.", o: ["I will go hiking in the sea.", "I will go hiking in the mountains."], a: "I will go hiking in the mountains." },
                { q: "We swims every friday.", o: ["We swims every friday.", "We swim every friday."], a: "We swim every friday." },
                { q: "She ate water five minutes ago.", o: ["She ate water...", "She drank water..."], a: "She drank water..." },
                { q: "Is my friend calls every day?", o: ["Is my friend calls...?", "Does my friend call...?"], a: "Does my friend call...?" },
                { q: "We does laundry every week.", o: ["We does laundry...", "We do laundry..."], a: "We do laundry..." },
                { q: "Amira and Lucy am ten years old.", o: ["Amira and Lucy am...", "Amira and Lucy are..."], a: "Amira and Lucy are..." }
            ],
            'speaking2': [ // Lvl 2
                { q: "She ___ allergic to dairy, so she ___ drink milk.", o: ["is / don't", "are / does", "is / doesn't"], a: "is / doesn't" },
                { q: "My grandmother is disabled. So she ___ visit us because she ___ walk.", o: ["can / can't", "can't / can't", "can / can"], a: "can't / can't" },
                { q: "There is ___ power outage, so we ___ use a lot of electronic devices.", o: ["a / don't", "an / don't", "a / do"], a: "a / don't" },
                { q: "Lisa wanted to ___ clean the village. She ___ many empty plastic bottles...", o: ["helped / see", "help / saw", "helping / saw"], a: "help / saw" },
                { q: "Dana ___ Tanya to write... But Tanya replied... that it depends ___ the animal conditions.", o: ["tell / under", "told / on", "told / under"], a: "told / on" },
                { q: "My father ___ ___ police officer, so he ___ commit crimes.", o: ["is / a / doesn't", "are / an / does", "is / an / doesn't"], a: "is / a / doesn't" },
                { q: "I ___ to bake a cake for my friend ___ birthday, but I ran out of eggs...", o: ["wanted / friend's", "want / friend", "wanted / friend"], a: "wanted / friend's" },
                { q: "My phone ___ down after it fell on the ___.", o: ["broke / hard concrete", "break / soft pillow", "broke / soft pillow"], a: "broke / hard concrete" }
            ],
            'adjectivesQuiz': [
                { q: "1. האם צבעים הם גם תארים?", o: ["כן", "לא"], a: "כן" },
                { q: "2. איך לומר באנגלית 'הכי רך'?", o: ["Softer", "Softest", "More soft"], a: "Softest" },
                { q: "3. תרגם: This bag is the most expensive in that shop", o: ["התיק הזה יקר בחנות", "התיק הזה הכי יקר בחנות הזאת", "זה תיק יקר"], a: "התיק הזה הכי יקר בחנות הזאת" },
                { q: "4. תרגם: she is the most beautiful woman in the world", o: ["היא אישה יפה בעולם", "היא האישה הכי יפה בעולם", "היא אישה יפה"], a: "היא האישה הכי יפה בעולם" },
                { q: "5. תרגם: דן הוא הילד הכי חכם בכיתה.", o: ["Dan is a smart boy in class", "Dan is smarter in class", "Dan is the smartest boy in the class"], a: "Dan is the smartest boy in the class" },
                { q: "6. תרגם: הכלב הכי חמוד", o: ["The cutest dog", "The cute dog", "Dog is cute"], a: "The cutest dog" },
                { q: "7. תרגם: הפיצה הכי טעימה.", o: ["The tasty pizza", "The more tasty pizza", "The tastiest pizza"], a: "The tastiest pizza" },
                { q: "8. מה יוצא דופן?", o: ["pink", "purple", "dog"], a: "dog" },
                { q: "9. מה יוצא דופן?", o: ["cold", "cool", "tallest"], a: "tallest" },
                { q: "10. מה יוצא דופן?", o: ["new", "fast", "tasty"], a: "new" } 
            ],
            // Reading Quizzes
            'reading1': [
                { q: "What is the dog's name?", o: ["Charlie", "Anna", "Max"], a: "Charlie" },
                { q: "Where do they play?", o: ["In the house", "In the park", "At school"], a: "In the park" },
                { q: "What does Anna throw for Charlie?", o: ["A stick", "A ball", "Food"], a: "A ball" },
                { q: "What do they do when they get tired?", o: ["Go home", "Sit under a tree", "Eat chips"], a: "Sit under a tree" }
            ],
            'reading2': [
                { q: "What does Tom find in his backyard?", o: ["A magic tree", "A magic paintbrush", "A rainbow"], a: "A magic paintbrush" },
                { q: "What happens to the tree Tom paints?", o: ["It falls down", "It disappears", "It comes to life"], a: "It comes to life" },
                { q: "What does Tom paint after the tree?", o: ["A flower", "A rainbow", "His friends"], a: "A rainbow" },
                { q: "Who does Tom share the magic with?", o: ["His family", "His teacher", "His friends"], a: "His friends" }
            ],
            'reading3': [
                { q: "What is the fox's name?", o: ["Max", "Storm", "Bird"], a: "Max" },
                { q: "What did Max see in the tree?", o: ["A squirrel", "A bird's nest", "His family"], a: "A bird's nest" },
                { q: "What did Max do with the nest?", o: ["He caught it and moved it", "He left it alone", "He told his family"], a: "He caught it and moved it" },
                { q: "How did Max feel after helping?", o: ["Tired", "Proud", "Scared"], a: "Proud" },
                { q: "Why did Max's family clap for him?", o: ["For being brave and kind", "For finding food", "For winning a race"], a: "For being brave and kind" }
            ],
            'reading4': [
                { q: "Where did Jake and Mia find the cave?", o: ["In the school", "In the park", "In the forest"], a: "In the forest" },
                { q: "How did Mia feel about going inside?", o: ["Only scared", "Only excited", "Excited and a little scared"], a: "Excited and a little scared" },
                { q: "What did they find inside the cave?", o: ["A small animal", "A small treasure chest", "Their teacher"], a: "A small treasure chest" },
                { q: "What happened after they opened the chest?", o: ["The cave started shaking", "They found gold", "A noise stopped"], a: "The cave started shaking" }
            ],
            'reading5': [
                { q: "Who was Captain Moshco?", o: ["A famous soldier", "A famous pirate", "A famous captain"], a: "A famous pirate" },
                { q: "What did the old map show?", o: ["A hidden island", "A new ship", "A jungle"], a: "A hidden island" },
                { q: "Where was the 'X' on the map?", o: ["In a cave", "Under a big, old tree", "On the beach"], a: "Under a big, old tree" },
                { q: "What was inside the chest?", o: ["Gold coins, jewels, and a sword", "Only gold coins", "An old map"], a: "Gold coins, jewels, and a sword" },
                { q: "Who won the fight?", o: ["The enemy captain", "Captain Moshco's crew", "Nobody"], a: "Captain Moshco's crew" }
            ]
        };
        
        // --- INITIALIZE ---
        initYouTubePage();
        showPage('home-page'); // Start on the home page

    });
    </script>

    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/690b64f3418b98195b55049c/1j9a84lpt';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    </body>
</html>
